<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Lorenz 63 · NPSMC.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="NPSMC.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">NPSMC.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../models/">Models</a></li><li><a class="tocitem" href="../../data_assimilation/">Data Assimilation</a></li><li><a class="tocitem" href="../../state_space/">State Space</a></li><li class="is-active"><a class="tocitem" href>Lorenz 63</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#USING-PACKAGES-1"><span>USING PACKAGES</span></a></li><li class="toplevel"><a class="tocitem" href="#TEST-ON-LORENZ-63-1"><span>TEST ON LORENZ-63</span></a></li><li class="toplevel"><a class="tocitem" href="#Remark-1"><span>Remark</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Lorenz 63</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Lorenz 63</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/npsmc/NPSMC.jl/blob/master/docs/src/examples/lorenz63.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Lorenz-63-1"><a class="docs-heading-anchor" href="#Lorenz-63-1">Lorenz 63</a><a class="docs-heading-anchor-permalink" href="#Lorenz-63-1" title="Permalink"></a></h1><p>Data assimilation are numerical methods used in geosciences to mix the information of observations (noted as <span>$y$</span>) and a dynamical model (noted as <span>$f$</span>) in order to estimate the true/hidden state of the system (noted as <span>$x$</span>) at every time step <span>$k$</span>. Usually, they are related following a nonlinear state-space model: &lt;img src=https://tandeo.files.wordpress.com/2019/02/formule<em>nnss</em>model.png width=&quot;200&quot;&gt; with <span>$\eta$</span> and <span>$\epsilon$</span> some independant white Gaussian noises respectively respresenting the model forecast error and the error of observation.</p><p>In classical data assimilation, we require multiple runs of an explicit dynamical model <span>$f$</span> with possible severe limitations including the computational cost, the lack of consistency of the model with respect to the observed data as well as modeling uncertainties. Here, an alternative strategy is explored by developing a fully data-driven assimilation. No explicit knowledge of the dynamical model is required. Only a representative catalog of trajectories of the system is assumed to be available. Based on this catalog, the Analog Data Assimilation (AnDA) is introduced by combining machine learning with the analog method (or nearest neighbor search) and stochastic assimilation techniques including Ensemble Kalman Filter and Smoother (EnKF, EnKS) and Particle Filter (PF). We test the accuracy of the technic on different chaotic dynamical models, the Lorenz-63 and Lorenz-96 systems.</p><p>This Julia program is dervied from the Python library is attached to the following publication: Lguensat, R., Tandeo, P., Ailliot, P., Pulido, M., &amp; Fablet, R. (2017). The Analog Data Assimilation. <em>Monthly Weather Review</em>, 145(10), 4093-4107. If you use this library, please do not forget to cite this work.</p><h1 id="USING-PACKAGES-1"><a class="docs-heading-anchor" href="#USING-PACKAGES-1">USING PACKAGES</a><a class="docs-heading-anchor-permalink" href="#USING-PACKAGES-1" title="Permalink"></a></h1><p>Here, we import the different Julia packages. In order to use the analog methog (or nearest neighboor search), we need to install the <a href="https://github.com/npsmc/NPSMC.jl">&quot;NPSMC&quot; library</a>.</p><pre><code class="language-">using Plots, DifferentialEquations, NPSMC</code></pre><h1 id="TEST-ON-LORENZ-63-1"><a class="docs-heading-anchor" href="#TEST-ON-LORENZ-63-1">TEST ON LORENZ-63</a><a class="docs-heading-anchor-permalink" href="#TEST-ON-LORENZ-63-1" title="Permalink"></a></h1><p>To begin, as dynamical model <span>$f$</span>, we use the Lorenz-63 chaotic system. First, we generate simulated trajectories from this dynamical model and store them into the catalog. Then, we use this catalog to emulate the dynamical model and we apply the analog data assimilation. Finally, we compare the results of this data-driven approach to the classical data assimilation (using the true Lorenz-63 equations as dynamical model).</p><h3 id="GENERATE-SIMULATED-DATA-(LORENZ-63-MODEL)-1"><a class="docs-heading-anchor" href="#GENERATE-SIMULATED-DATA-(LORENZ-63-MODEL)-1">GENERATE SIMULATED DATA (LORENZ-63 MODEL)</a><a class="docs-heading-anchor-permalink" href="#GENERATE-SIMULATED-DATA-(LORENZ-63-MODEL)-1" title="Permalink"></a></h3><pre><code class="language-">σ = 10.0
ρ = 28.0
β = 8.0/3

dt_integration = 0.01
dt_states      = 1
dt_obs         = 8
parameters     = [σ, ρ, β]
var_obs        = [1]
nb_loop_train  = 100
nb_loop_test   = 10
sigma2_catalog = 0.0
sigma2_obs     = 2.0

ssm = StateSpaceModel( lorenz63,
                       dt_integration, dt_states, dt_obs,
                       parameters, var_obs,
                       nb_loop_train, nb_loop_test,
                       sigma2_catalog, sigma2_obs )</code></pre><p>compute u0 to be in the attractor space</p><pre><code class="language-">u0    = [8.0;0.0;30.0]
tspan = (0.0,5.0)
prob  = ODEProblem(ssm.model, u0, tspan, parameters)
u0    = last(solve(prob, reltol=1e-6, save_everystep=false))

xt, yo, catalog = generate_data( ssm, u0 );

plot( xt.t, vcat(xt.u&#39;...)[:,1])
scatter!( yo.t, vcat(yo.u&#39;...)[:,1]; markersize=2)

regression = :local_linear
sampling = :gaussian
k, np = 100, 500</code></pre><h3 id="CLASSICAL-DATA-ASSIMILATION-(dynamical-model-given-by-the-catalog)-1"><a class="docs-heading-anchor" href="#CLASSICAL-DATA-ASSIMILATION-(dynamical-model-given-by-the-catalog)-1">CLASSICAL DATA ASSIMILATION (dynamical model given by the catalog)</a><a class="docs-heading-anchor-permalink" href="#CLASSICAL-DATA-ASSIMILATION-(dynamical-model-given-by-the-catalog)-1" title="Permalink"></a></h3><pre><code class="language-">data_assimilation = DataAssimilation( ssm, xt )
x̂_classical = data_assimilation(yo, EnKS(np))
@time RMSE( xt, x̂_classical)</code></pre><h3 id="ANALOG-DATA-ASSIMILATION-(dynamical-model-given-by-the-catalog)-1"><a class="docs-heading-anchor" href="#ANALOG-DATA-ASSIMILATION-(dynamical-model-given-by-the-catalog)-1">ANALOG DATA ASSIMILATION (dynamical model given by the catalog)</a><a class="docs-heading-anchor-permalink" href="#ANALOG-DATA-ASSIMILATION-(dynamical-model-given-by-the-catalog)-1" title="Permalink"></a></h3><pre><code class="language-">f  = AnalogForecasting( k, xt, catalog; regression = regression, sampling   = sampling )
data_assimilation = DataAssimilation( f, xt, ssm.sigma2_obs )
x̂_analog = data_assimilation(yo, EnKS(np))
@time RMSE( xt, x̂_analog)</code></pre><h3 id="COMPARISON-BETWEEN-CLASSICAL-AND-ANALOG-DATA-ASSIMILATION-1"><a class="docs-heading-anchor" href="#COMPARISON-BETWEEN-CLASSICAL-AND-ANALOG-DATA-ASSIMILATION-1">COMPARISON BETWEEN CLASSICAL AND ANALOG DATA ASSIMILATION</a><a class="docs-heading-anchor-permalink" href="#COMPARISON-BETWEEN-CLASSICAL-AND-ANALOG-DATA-ASSIMILATION-1" title="Permalink"></a></h3><pre><code class="language-">plot( xt.t, vcat(xt.u&#39;...)[:,1], label=&quot;true state&quot;)
plot!( xt.t, vcat(x̂_classical.u&#39;...)[:,1], label=&quot;classical&quot;)
plot!( xt.t, vcat(x̂_analog.u&#39;...)[:,1], label=&quot;analog&quot;)
scatter!( yo.t, vcat(yo.u&#39;...)[:,1]; markersize=2, label=&quot;observations&quot;)</code></pre><p>The results show that performances of the data-driven analog data assimilation are closed to those of the model-driven data assimilation. The error can be reduced by augmenting the size of the catalog &quot;nb<em>loop</em>train&quot;.</p><h1 id="Remark-1"><a class="docs-heading-anchor" href="#Remark-1">Remark</a><a class="docs-heading-anchor-permalink" href="#Remark-1" title="Permalink"></a></h1><p>Note that for all the previous experiments, we use the robust Ensemble Kalman Smoother (EnKS) with the increment or local linear regressions and the Gaussian sampling. If you want to have realistic state estimations, we preconize the use of the Particle Filter (DA.method = &#39;PF&#39;) with the locally constant regression (AF.regression = &#39;locally_constant&#39;) and the multinomial sampler (AF.sampling = &#39;multinomial&#39;) with a large number of particles (DA.N). For more details about the different options, see the attached publication: Lguensat, R., Tandeo, P., Ailliot, P., Pulido, M., &amp; Fablet, R. (2017). The Analog Data Assimilation. <em>Monthly Weather Review</em>, 145(10), 4093-4107.</p><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ex_time_series/">« Time Series</a><a class="docs-footer-nextpage" href="../lorenz96/">Lorenz 96 »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 22 November 2019 18:13">Friday 22 November 2019</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
